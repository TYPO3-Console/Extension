#!/usr/bin/env php
<?php

use TYPO3\CMS\Core\Core\ClassLoadingInformation;

call_user_func(static function () {
    $packageStatesFile = __DIR__ . '/../../PackageStates.php';
    $autoLoadDir = __DIR__ . '/../../autoload';
    $autoLoadPsr4 = $autoLoadDir . '/autoload_psr4.php';
    $autoLoadClassmap = $autoLoadDir . '/autoload_classmap.php';
    if (is_dir($autoLoadDir) || file_exists($packageStatesFile)) {
        echo "Can not init TYPO3 Console because TYPO3 is set up already. use typo3 extension:activate typo3_console to activate it\n";
        exit(1);
    }
    mkdir($autoLoadDir);
    file_put_contents(
        $autoLoadPsr4,
        <<<'EOF'
<?php

// autoload_classmap.php @generated by TYPO3

$typo3InstallDir = \TYPO3\CMS\Core\Core\Environment::getPublicPath() . '/';

return array(
    'Helhum\\Typo3Console\\' => array($typo3InstallDir . 'typo3conf/ext/typo3_console/Classes/Console',$typo3InstallDir . 'typo3conf/ext/typo3_console/Classes/Compatibility'),
);
EOF
    );
    file_put_contents(
        $autoLoadClassmap,
        <<<'EOF'
<?php

// autoload_classmap.php @generated by TYPO3

return array(
);
EOF
    );

});
